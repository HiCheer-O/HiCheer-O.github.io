import{_ as s,c as i,o as a,a as t}from"./app-Y7YybkpV.js";const e="/assets/image-20240809205730462-BQcQMR0m.png",n="/assets/image-20240809205854341-B3XXiFfa.png",p="/assets/image-20240809210306570-D11dR7Kk.png",l="/assets/image-20240809210418024-BjyPI2_b.png",h="/assets/image-20240809210508213-oiD3s7Jv.png",k="/assets/image-20240809210633616-DwVa--Jo.png",d="/assets/image-20240809211504901-Di0DAmwD.png",r="/assets/image-20240809211619427-6CB46nbP.png",o="/assets/image-20240809211844394-DKPfCotp.png",c="/assets/image-20240809211921054-DUGNlIW0.png",g={},m=t(`<h3 id="安装" tabindex="-1"><a class="header-anchor" href="#安装"><span>安装</span></a></h3><blockquote><p>基于 Docker 容器安装，总共安装了三个镜像（bitnami/prometheus、grafana/grafana、node-exporter）</p></blockquote><ol><li><p>创建挂载目录/文件</p><ul><li><p><code>prometheus</code>数据挂载目录</p><blockquote><p>注意⚠️：必须要赋予权限</p></blockquote><div class="language-bash" data-ext="bash" data-title="bash"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">mkdir</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> prometheus_data</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">chown</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -R</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> 1001:1001</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">  prometheus_data</span></span></code></pre></div></li><li><p>创建<code>prometheus.yml</code>配置文件</p><div class="language-yaml" data-ext="yaml" data-title="yaml"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">global</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">  scrape_interval</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> 15s</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">scrape_configs</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">  -</span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;"> job_name</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">prometheus</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">    static_configs</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">      -</span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;"> targets</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> [</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">localhost:9090</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">]</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">  # 下面这个 job 可以先省略，后面安装了 node-exporte，再配置</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">  -</span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;"> job_name</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">node_exporter</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">    static_configs</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">      -</span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;"> targets</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> [</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">192.168.2.80:9100</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">]</span></span></code></pre></div></li><li><p><code>grafana</code>数据挂载目录</p><blockquote><p>注意⚠️：必须要赋予权限</p></blockquote><div class="language-bash" data-ext="bash" data-title="bash"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">mkdir</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> grafana_data</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">chown</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> 472:472</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> grafana_data</span></span></code></pre></div></li><li><p>创建<code>grafana.ini</code>配置文件</p><blockquote><p>这个配置文件内容太多了，建议是先启动一个容器，然后从容器中拷贝出来</p></blockquote><div class="language-bash" data-ext="bash" data-title="bash"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">docker</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> cp</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> 容器ID:/etc/grafana/grafana.ini</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> ./</span></span></code></pre></div></li></ul></li><li><p>创建启动文件</p><ul><li><code>docker-compose.yml</code>文件<div class="language-yaml" data-ext="yaml" data-title="yaml"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">services</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">  prometheus</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">    image</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> bitnami/prometheus:latest</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">    container_name</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> prometheus</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">    volumes</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">      -</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> ./prometheus_data:/opt/bitnami/prometheus/data</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">      -</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> ./prometheus.yml:/opt/bitnami/prometheus/conf/prometheus.yml</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">    ports</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">      -</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">9090:9090</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">  grafana</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">    image</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> grafana/grafana:latest</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">    container_name</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> grafana</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">    environment</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">      -</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> GF_SERVER_ROOT_URL=http://grafana.server.name</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">      -</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> GF_SECURITY_ADMIN_PASSWORD=admin</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">      -</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> GF_SECURITY_ADMIN_USER=admin</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">    volumes</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">      -</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> ./grafana_data:/var/lib/grafana</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">      -</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> ./grafana.ini:/etc/grafana/grafana.ini</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">    ports</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">      -</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">3000:3000</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">    depends_on</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">      -</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> prometheus</span></span></code></pre></div></li></ul></li><li><p>启动</p><ul><li><p>node_exporter</p><blockquote><p>我这个容器是用来监测我宿主机的指标情况的（cpu、内存、存储等等），默认端口：9100</p></blockquote><div class="language-bash" data-ext="bash" data-title="bash"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">docker</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> run</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -d</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> \\</span></span>
<span class="line"><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">  --name=node_exporter</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> \\</span></span>
<span class="line"><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">  --net=</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">host</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> \\</span></span>
<span class="line"><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">  prom/node-exporter:latest</span></span></code></pre></div></li><li><p>prometheus、grafana</p><div class="language-bash" data-ext="bash" data-title="bash"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">docker-compose</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> up</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -d</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> ./docker-compose.yml</span></span></code></pre></div></li></ul></li><li><p>访问</p><ul><li><p>node_exporter</p><div class="language-http" data-ext="http" data-title="http"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">http://192.168.2.80:9100/metrics</span></span></code></pre></div><p><img src="`+e+'" alt="image-20240809205730462" width="3118" height="1424"></p></li><li><p>prometheus</p><div class="language-http" data-ext="http" data-title="http"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">http://192.168.2.80:9090/graph</span></span></code></pre></div><p><img src="'+n+'" alt="image-20240809205854341" width="3144" height="1004"></p></li><li><p>grafana</p><div class="language-http" data-ext="http" data-title="http"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">http://192.168.2.80:3000/login</span></span></code></pre></div></li></ul></li></ol><h3 id="配置" tabindex="-1"><a class="header-anchor" href="#配置"><span>配置</span></a></h3><ol><li><p>中文配置</p><p><img src="'+p+'" alt="image-20240809210306570" width="3160" height="2466"></p></li><li><p>添加数据源</p><p><img src="'+l+'" alt="image-20240809210418024" width="3186" height="1344"></p><p><img src="'+h+'" alt="image-20240809210508213" width="3158" height="1566"></p><p><img src="'+k+'" alt="image-20240809210633616" width="3208" height="1814"></p><p>只添加这一个地址就可以保存了。</p></li><li><p>仪表板</p><blockquote><p>因为<code>Grafana</code>有各种各样的仪表板、例如 ES、mysql等等；</p><p>当然<code>Grafana</code>他本身是只是提供了制作仪表板功能；也就是可以通过导入别人已经做好、也可以自己动手搞（界面只有英文哦）；</p><p>我下面是通过<code>仪表板商店</code>导出别人做好的，下面以 linux 指标监控面板为例</p></blockquote><p><img src="'+d+'" alt="image-20240809211504901" width="3132" height="832"></p><p><img src="'+r+'" alt="image-20240809211619427" width="3120" height="1640"></p><blockquote><p>有很多自己选择</p></blockquote><p><img src="'+o+'" alt="image-20240809211844394" width="3134" height="1560"></p><p><img src="'+c+'" alt="image-20240809211921054" width="3226" height="1984"> :::</p></li></ol>',5),y=[m];function u(A,B){return a(),i("div",null,y)}const v=s(g,[["render",u],["__file","index.html.vue"]]),C=JSON.parse(`{"path":"/article/4nv5oawj/","title":"Prometheus 安装及配置","lang":"zh-CN","frontmatter":{"title":"Prometheus 安装及配置","author":"HiCheer","createTime":"2024/08/09 20:20:35","permalink":"/article/4nv5oawj/","tags":["运维","Docker","Grafana","Prometheus"],"head":[["script",{"id":"check-dark-mode"},";(function () {const um= localStorage.getItem('vuepress-theme-appearance') || 'auto';const sm = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;if (um === 'dark' || (um !== 'light' && sm)) {document.documentElement.classList.add('dark');}})();"],["script",{"id":"check-mac-os"},"document.documentElement.classList.toggle('mac', /Mac|iPhone|iPod|iPad/i.test(navigator.platform))"]]},"headers":[{"level":3,"title":"安装","slug":"安装","link":"#安装","children":[]},{"level":3,"title":"配置","slug":"配置","link":"#配置","children":[]}],"readingTime":{"minutes":1.64,"words":491},"git":{"createdTime":1723212461000,"updatedTime":1726124423000,"contributors":[{"name":"HiCheer-O","email":"chendangdang1998@gmail.com","commits":1}]},"filePathRelative":"运维/prometheus/Prometheus 安装及配置.md","categoryList":[{"id":"60eec8","sort":10009,"name":"运维"},{"id":"ea0811","sort":10017,"name":"prometheus"}]}`);export{v as comp,C as data};
